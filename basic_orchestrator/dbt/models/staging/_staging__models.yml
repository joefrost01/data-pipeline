version: 2

models:
  - name: stg_load_metadata
    description: |
      Staged load metadata with derived fields for bi-temporal processing.
      
      Extracts from filename:
      - feed_name: Stable identifier (e.g., "futures_order_events")
      - business_date: The date this data represents (explicit or inferred)
      
      Enables tracking which load is the "latest truth" for any feed + business date.
    
    columns:
      - name: load_id
        description: Unique load identifier
        tests:
          - unique
          - not_null
      
      - name: feed_name
        description: Stable feed identifier extracted from filename
      
      - name: business_date
        description: Business date this data represents
      
      - name: loaded_at
        description: When the file was loaded
      
      - name: is_latest_for_business_date
        description: True if this is the most recent load for this feed + business date

  - name: stg_futures_order_events
    description: |
      Staged futures order events with defensive typing.
      One row per order lifecycle event.
      Includes bi-temporal context from load metadata.
    
    columns:
      - name: event_timestamp_utc
        description: Event timestamp in UTC
        tests:
          - not_null:
              severity: warn
      
      - name: event_seq
        description: Sequence number within the order
        tests:
          - not_null:
              severity: warn
      
      - name: event_type
        description: Event type
        tests:
          - not_null:
              severity: warn
          - accepted_values:
              values: ['NEW', 'SENT', 'ACK', 'PARTIAL_FILL', 'FILL', 'CANCEL', 'REJECTED']
              severity: warn
      
      - name: order_id
        description: Unique order identifier
        tests:
          - not_null:
              severity: warn
      
      - name: trader_id
        description: Trader identifier
        tests:
          - not_null:
              severity: warn
      
      - name: desk
        description: Trading desk
        tests:
          - not_null:
              severity: warn
      
      - name: book
        description: Trading book
        tests:
          - not_null:
              severity: warn
      
      - name: symbol
        description: Instrument symbol
        tests:
          - not_null:
              severity: warn
      
      - name: exchange
        description: Exchange code
        tests:
          - not_null:
              severity: warn
      
      - name: side
        description: Order side
        tests:
          - not_null:
              severity: warn
          - accepted_values:
              values: ['BUY', 'SELL']
              severity: warn
      
      - name: loaded_at
        description: When this data was loaded (from load_metadata)
      
      - name: business_date
        description: Business date this data represents
